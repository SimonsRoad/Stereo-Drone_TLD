<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Hector Pose Estimation Core (Spiri): Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Hector Pose Estimation Core (Spiri)
   &#160;<span id="projectnumber">0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Creating a Pose Estimation Node</h2>
<ol type="1">
<li>Create a <a class="el" href="classhector__pose__estimation_1_1_pose_estimation.html">PoseEstimation</a> This is the main structure that will keep references to the state, systems, and measurements, as well as run the main update loop.</li>
<li>Add a system model. This class holds the system model used in the update step. It is possible to implement your own, but <a class="el" href="classhector__pose__estimation_1_1_generic_quaternion_system_model.html">GenericQuaternionSystemModel</a> and <a class="el" href="classhector__pose__estimation_1_1_ground_vehicle_model.html">GroundVehicleModel</a> are included and cover many use cases. Both of these systems use sensor-only state updates ie. they use imu data rather than commands to make state predictions.</li>
<li>Add <a class="el" href="classhector__pose__estimation_1_1_measurement.html">Measurements</a> to the PoseEstimation object with <code>pose_estimation_-&gt;addMeasurement</code>. There are a few useful Measurements already defined such as <a class="el" href="classhector__pose__estimation_1_1_g_p_s.html">GPS</a>, <a class="el" href="classhector__pose__estimation_1_1_height.html">Height</a>, etc.</li>
<li>Define subscribers and callbacks for each input to the System Model and for each measurement. The system won't make any predictions unless the inputs to the system model are receiving updates, but will only produce warnings if certain measurements time out. See example callbacks in <a href="https://github.com/Pleiades-Spiri/spiri_navigation/blob/master/spiri_pose_estimation/src/pose_estimation_node.cpp">pose_estimation_node.cpp</a> on the Pleiades Github.</li>
<li>Define publishers and a publish function to be called whenever new system update data has been processed. See the documentation for <a class="el" href="classhector__pose__estimation_1_1_pose_estimation.html">PoseEstimation</a> for how to get the current estimate.</li>
</ol>
<h3>Measurements</h3>
<p><b>TODO How to create custom measurements or extend existing ones</b></p>
<h3>Systems</h3>
<p><b>TODO How to create custom system models or extend existing ones</b></p>
<h2>Extended Kalman Filter Primer</h2>
<p><b>Disclaimer</b></p>
<p>Before getting into using this package for pose estimation, you need to have at least a basic understanding of the Extended Kalman Filter. This section is not even close to complete. For a less brief introduction, I suggest lectures 2-5 of Cyrill Stachniss class on robot mapping which has both <a href="http://ais.informatik.uni-freiburg.de/teaching/ws13/mapping/index_en.php">notes</a> and <a href="http://www.youtube.com/watch?v=jgOQuGAEnX8">lectures</a> available. There is also a high quality <a href="http://en.wikipedia.org/wiki/Extended_Kalman_filter">Wikipedia entry</a> on EKFs.</p>
<h3>EKF</h3>
<p>The Extended Kalman Filter is a powerful technique to recursively compute the state of a system at time <img class="formulaInl" alt="$t$" src="form_4.png"/>, <img class="formulaInl" alt="$x_t$" src="form_5.png"/> given observations <img class="formulaInl" alt="$z_{1:t}$" src="form_8.png"/> and commands <img class="formulaInl" alt="$u_{1:t}$" src="form_9.png"/>. As with other bayes filters, the algorithm is divided into an update step which uses new commands to make a prediction about the state, and a correction step, which uses the observations to make corrections to the predicted state.</p>
<p>The key trick of the Kalman filter is to assume that all the noise is gaussian, and all the update rules are linear. This lets the algorithm update it's belief about the world efficiently, since gaussians can be combined by efficient operations on their means and covariances.</p>
<p>The key trick of the Extended Kalman filter is to make non-linear update rules linear using the first Taylor Expansion, ie by using the Jacobian at the mean estimate.</p>
<p>...fill me in more...</p>
<h3>Algorithm</h3>
<p><img class="formulaInl" alt="$EKF\left(\mu_{t-1}, \Sigma_{t-1}, u_t, z_t \right):$" src="form_16.png"/></p>
<p>Update</p>
<ol type="1">
<li><img class="formulaInl" alt="$\overline{\mu}_t = g\left(u_t, \mu_{t-1}\right)$" src="form_28.png"/></li>
<li><img class="formulaInl" alt="$\overline{\Sigma}_t = G_t\Sigma_{t-1}G_t^T + R_t $" src="form_21.png"/></li>
</ol>
<p>Correction</p>
<ol type="1">
<li><img class="formulaInl" alt="$K_t = \overline{\Sigma}_tH_t^T\left(H_t\overline{\Sigma}_tH_t^T + Q_t\right)^{-1}$" src="form_23.png"/></li>
<li><img class="formulaInl" alt="$\mu_t = \overline{\mu}_t + K_t\left(z_t - h\left(\overline{\mu}_t\right)\right)$" src="form_24.png"/></li>
<li><img class="formulaInl" alt="$ \Sigma_t = \left(I - K_tH_t\right)\overline{Sigma}_t$" src="form_25.png"/> 6.return <img class="formulaInl" alt="$ \mu_t, \Sigma_t $" src="form_27.png"/></li>
</ol>
<h3>Notation</h3>
<p>Keep this notation in mind, as it is used fairly consistently for variable naming throughout the code.</p>
<table class="doxtable">
<tr>
<th>Basic Symbols </th><th>-  </th></tr>
<tr>
<td><img class="formulaInl" alt="$t$" src="form_4.png"/> </td><td>current time </td></tr>
<tr>
<td><img class="formulaInl" alt="$x_t$" src="form_5.png"/> </td><td>state at time t </td></tr>
<tr>
<td><img class="formulaInl" alt="$z_t$" src="form_10.png"/> </td><td>observation at time t </td></tr>
<tr>
<td><img class="formulaInl" alt="$u_t$" src="form_11.png"/> </td><td>command at time t </td></tr>
<tr>
<td><img class="formulaInl" alt="$\mu_t$" src="form_12.png"/> </td><td>mean belief at time t </td></tr>
<tr>
<td><img class="formulaInl" alt="$\Sigma_t$" src="form_29.png"/></td><td>covariance matrix of belief at time t </td></tr>
</table>
<table class="doxtable">
<tr>
<th>Update </th><th>-  </th></tr>
<tr>
<td><img class="formulaInl" alt="$g\left(u, \mu\right)$" src="form_30.png"/> </td><td>function mapping a command and prediction to a new prediction </td></tr>
<tr>
<td><img class="formulaInl" alt="$G$" src="form_31.png"/> </td><td>Jacobian of <img class="formulaInl" alt="$g$" src="form_32.png"/> </td></tr>
<tr>
<td><img class="formulaInl" alt="$R$" src="form_33.png"/> </td><td>State transition gaussian noise </td></tr>
</table>
<table class="doxtable">
<tr>
<th>Correction </th><th>-  </th></tr>
<tr>
<td><img class="formulaInl" alt="$K$" src="form_34.png"/> </td><td>Kalman gain. Controls confidence in prediction vs confidence in sensor corrections. </td></tr>
<tr>
<td><img class="formulaInl" alt="$Q$" src="form_35.png"/> </td><td>Observation gaussian noise </td></tr>
<tr>
<td><img class="formulaInl" alt="$h\left(\mu\right)$" src="form_36.png"/> </td><td>function mapping a prediction to an observation </td></tr>
</table>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 10 2014 12:19:41 for Hector Pose Estimation Core (Spiri) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
